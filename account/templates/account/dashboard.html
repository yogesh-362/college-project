{% extends 'account/base.html' %}

{% load static %}
{% block main-content %}


<div class="content">
    <div class="post" id="kt_post">
        <!-- Container -->
        <div id="kt_content_container" class="container-xxl" >
            <meta name="_token" value="GnxI213sOLraQGVIq0mfqLMyWSBJUonIw7RJrNIH">
            <div class="row gy-5" >
                <!-- Left Column -->
                <div class="col-xl-8 d-flex" >
                    <!-- List Widget 3 -->
                    <div class="card card-xxl-stretch mb-xl-3" >
                        <!-- Header -->
                        <div class="card-header card_header border-0 ">
                            <h5 class="card-title fw-bolder text-dark" >Today Birthday</h5>
                        </div>
                        <!-- Body -->
                         <div class="card-body pt-2">
                                    <div class="flex-grow-1" id="today-birthday-details">
                                        <table class="table table_main" style="font-size:12px">
                                            <thead>
                                                <tr>
                                                    <th>Sr. No</th>
                                                    <th>Name</th>
                                                    <th>Date of Birth</th>
                                                </tr>
                                            </thead>
                                            <tbody id="today-birthday-details-table">
                                                <!-- Table rows will be dynamically added here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                    </div>
                </div>
                <!-- Right Column -->
                <div class="col-xl-4 d-flex">
                    <!-- List Widget 3 -->
                    <div class="card card-xxl-stretch mb-xl-3">
                        <!-- Header -->
                        <div class="card-header card_header border-0">
                            <h5 class="card-title fw-bolder text-dark">QR-Code</h5>
                        </div>
                        <!-- Body -->
                        <div class="card-body pt-2">
                            <div class="d-flex align-items-center mb-8 mt-2">
                                <span class="badge fs-8 fw-bolder">
<!--                                    <img style="width:100px; height:100px;" src="https://chart.googleapis.com/chart?chs=400x400&amp;cht=qr&amp;chl=89b0c2d8d8a35d1e74a8edf68ddd5b4fd3d821e0d8653a937c0b159fc6d24e8e&amp;choe=UTF-8">-->
                                         <!-- Add this div where you want to display the QR code -->
                                            <div id="qrcode-container">
                                                <img id="qr-code-image" style="height:150px;width:150px;margin-left:-13px;" src="http://127.0.0.1:8000/generate-qr/" alt="QR Code">
                                            </div>

                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row gy-5 mt-3">
                <!-- Left Column -->
                <div class="col-xl-5 d-flex">
                    <!-- Tables Widget 9 -->
                    <div class="card card-xxl-stretch mb-5 mb-xl-5">
                        <!-- Header -->
                        <div class="card-header card_header border-0">
                            <h5 class="card-title fw-bolder text-dark">Employee Statistics</h5>
                        </div>
                        <div style="margin-left:10px;">
                            <a href="{% url 'inoutlist' %}" id="currentDate"></a>
                        </div>
                        <div class="card-body py-3">
                            <!-- Table Container -->
                            <div class="table-responsive">
                                <!-- Table -->
                                <table class="table table-row-dashed table-row-gray-300 align-middle table_main" style="font-size:12px;">
                                    <!-- Table Body -->
                                    <tbody>
                                        <tr>
                                            <th><b>IN</b></th>
                                            <th><b>OUT</b></th>
                                            <th><b>HOUR</b></th>
                                        </tr>
                                         <tr>
                                            <td id="lastScanInTime">{{request.user.last_scan_in_time}}</td>
                                            <td id="lastScanOutTime">{{request.user.last_scan_out_time}}</td>
                                            <td id="totalWorkedHours">{{request.user.total_worked_hours}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Right Column -->
                <div class="col-xl-7 d-flex">
                    <!-- List Widget 3 -->
                    <div class="card card-xxl-stretch mr-6 mb-xl-5">
                        <!-- Header -->
                        <div class="card-header border-0 card_header">
                            <h5 class="card-title fw-bolder text-dark">Today Task</h5>
                            <h5  class="card-title fw-bolder text-dark" id="today-date"></h5>
<!--                            <h3 class="card-title fw-bolder text-dark" id="currentDate" style="margin-left:340px;margin-top:-42px"></h3>-->
                        </div>
                        <!-- Body -->
                        <div class="card-body py-3">
                            <div class="table-responsive">
                                <table class="table align-middle table-row-dashed fs-6 gy-5 dataTable no-footer table_main" style="font-size:12px;">
                                    <thead>
                                        <tr class="fw-bolder text-muted">
                                            <th class="min-w-100px">Task Link</th>
                                            <th class="min-w-150px">Task Satar &amp; Paush</th>
                                            <th class="min-w-150px">Task Assign Date</th>
                                        </tr>
                                    </thead>
                                    <tbody class="fw-bold text-gray-600">
                                        <tr>
                                            <td colspan="10">There are no records found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Pagination -->
                        <div class="row">
                            <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start"></div>
                            <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                                <div class="dataTables_paginate paging_simple_numbers" id="kt_customers_table_paginate">
                                    <ul class="pagination">
                                        <li></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- Bootstrap JS (Optional) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <script>
        function logoutForm() {
          const logoutURL = 'http://127.0.0.1:8000/logout/';

          var storedRefreshToken = localStorage.getItem('refreshToken');
          var storedAccessToken = localStorage.getItem('accessToken');

          const logoutPayload = {
              refresh: storedRefreshToken
          };

          fetch(logoutURL, {
              method: 'POST',
              headers: {
                  'Authorization': 'Bearer '+ storedAccessToken,
                  'Content-Type': 'application/json',
                  'Accept': 'application/json',
              },
              body: JSON.stringify(logoutPayload),
          })
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Logout failed');
                  }
                  // Handle successful logout
                  else{
                      console.log("Logout Successful!");
                      window.location.href = '/home';
                  }
              })
              .catch(error => {
                  console.error('Error during logout:', error);
              });

      }
    </script>
    <script>
       <!-- JavaScript to set the src attribute of the QR code image -->

    document.addEventListener('DOMContentLoaded', function() {
        // Data to be encoded in the QR code (replace with your data)
        var qrCodeData = "http://127.0.0.1:8000/generate-qr/";

        // Set the src attribute of the QR code image
        document.getElementById('qr-code-image').src = qrCodeData;
    });
    </script>

   <script>
       document.addEventListener('DOMContentLoaded', function() {
        var todayDate = new Date();
        var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        var formattedDate = todayDate.toLocaleDateString('en-US', options);

        // Select the element where you want to display the date and insert the formatted date
        var dateElement = document.getElementById('today-date');
        if (dateElement) {
            dateElement.textContent = formattedDate;
        }
    });
   </script>
   <script>
function displayTodayBirthdayDetails() {
    // URL to fetch today's birthday details from the JavaScript API
    const todayBirthdayURL = 'http://127.0.0.1:8000/emp-list/'; // Replace with your actual endpoint

    // Get the current date
    const currentDate = new Date();
    const currentMonth = currentDate.getMonth() + 1; // Adding 1 because getMonth() returns zero-based month
    const currentDay = currentDate.getDate();

    // Make a request to fetch today's birthday details
    fetch(todayBirthdayURL)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch birthday details');
            }
            return response.json();
        })
        .then(data => {
            const tableBody = document.getElementById('today-birthday-details-table');

            // Clear any existing rows
            tableBody.innerHTML = '';

            // Check if there are any records found for today's birthday (day and month)
            const matchingBirthdays = data.filter(person => {
                // Check if emp_birthday is not null or undefined
                if (person.emp_birthday) {
                    const [, month, day] = person.emp_birthday.split('-'); // Ignore the year part
                    return parseInt(month) === currentMonth && parseInt(day) === currentDay;
                }
                return false;
            });

            if (matchingBirthdays.length > 0) {
                matchingBirthdays.forEach((birthdayPerson, index) => {
                    // Create a new row in the table
                    const row = document.createElement('tr');

                    const serialNumberCell = document.createElement('td');
                    serialNumberCell.textContent = index + 1;
                    row.appendChild(serialNumberCell);

                    // Populate the row with name and date of birth
                    const nameCell = document.createElement('td');
                    nameCell.textContent = birthdayPerson.emp_name;
                    row.appendChild(nameCell);

                    const dobCell = document.createElement('td');
                    dobCell.textContent = birthdayPerson.emp_birthday;
                    row.appendChild(dobCell);

                    // Append the row to the table body
                    tableBody.appendChild(row);
                });
            } else {
                // If no records found, display a message
                const noRecordsRow = document.createElement('tr');
                const noRecordsCell = document.createElement('td');
                noRecordsCell.setAttribute('colspan', '10');
                noRecordsCell.textContent = 'No birthday records found for today.';
                noRecordsRow.appendChild(noRecordsCell);
                tableBody.appendChild(noRecordsRow);
            }
        })
        .catch(error => {
            console.error('Error fetching birthday details:', error);
        });
}

// Call the function when the DOM content is loaded
document.addEventListener('DOMContentLoaded', function() {
    displayTodayBirthdayDetails();
});


   </script>


<script>



    // Get the current date
    var currentDate = new Date();

    // Format the date as "DD-MM-YYYY"
    var formattedDate = currentDate.getDate() + '-' + (currentDate.getMonth() + 1) + '-' + currentDate.getFullYear();

    // Update the content of the div with id "currentDate"
    document.getElementById('currentDate').innerText = formattedDate;


</script>

<!--   <script>-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        // Get the current date-->
<!--        var currentDate = new Date();-->

<!--        // Format the date as YYYY-MM-DD-->
<!--        var formattedDate = currentDate.getFullYear() + '-' + ('0' + (currentDate.getMonth() + 1)).slice(-2) + '-' + ('0' + currentDate.getDate()).slice(-2);-->

<!--        // Set the formatted date to the element with id="currentDate"-->
<!--        document.getElementById('currentDate').textContent = 'Date: ' + formattedDate;-->
<!--    });-->
<!--</script>-->

{% endblock main-content %}


